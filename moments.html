<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Mystery Moments â™¡</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap" rel="stylesheet">
    <style>
        /* Fit everything on one screen at 100% zoom */
        body { 
            overflow-y: auto; 
            height: 100vh; 
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding: 0;
            margin: 0;
        }

        .intro-section { margin-top: 15px; margin-bottom: 5px; z-index: 10; }
        
        .intro-text {
            font-family: 'Steph', sans-serif; font-size: 1.2rem; color: #db4e4e; font-weight: bold;
            background: rgba(255, 255, 255, 0.85); padding: 12px 25px; border-radius: 25px;
            display: inline-block; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        /* Wide spacing to prevent overlap */
        .boxes-container {
            display: flex; 
            flex-direction: row; 
            justify-content: center; 
            align-items: center; 
            gap: 130px; 
            margin: 25px auto; 
            max-width: 1400px; 
            perspective: 1000px; 
            min-height: 380px;
            transition: opacity 1s ease, transform 1s ease;
            z-index: 10;
        }

        .box-wrapper { position: relative; width: 220px; height: 200px; cursor: pointer; transition: transform 0.3s ease; }
        .box-wrapper:hover { transform: translateY(-10px); }

        .box-body {
            position: absolute; bottom: 0; width: 100%; height: 160px;
            background: repeating-linear-gradient(45deg, #ff8da1, #ff8da1 15px, #ffb6c1 15px, #ffb6c1 30px);
            border-radius: 0 0 15px 15px; box-shadow: inset 0 -10px 20px rgba(0,0,0,0.15), 5px 15px 35px rgba(0,0,0,0.3);
            display: flex; align-items: center; justify-content: center; z-index: 1; border: 3px solid #db4e4e; border-top: none;
        }

        .box-lid {
            position: absolute; top: 0; width: 230px; height: 45px; left: -5px;
            background: linear-gradient(135deg, #ff6b85 0%, #db4e4e 50%, #c43b3b 100%);
            border-radius: 10px; z-index: 3; transition: all 0.7s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            transform-origin: top; box-shadow: 0 8px 20px rgba(0,0,0,0.25); border: 2px solid #c43b3b;
        }

        .box-lid::after { content: "ðŸŽ€"; position: absolute; top: -30px; left: 50%; transform: translateX(-50%); font-size: 2.2rem; }

        .box-message {
            position: absolute; bottom: 0; left: -25px; width: 270px; max-height: 480px; background-color: #fffef0;
            padding: 25px; font-family: 'Indie Flower', cursive; font-size: 1.1rem; color: #333;
            border-radius: 10px; opacity: 0; transform: translateY(20px) scale(0.8); transition: all 0.5s ease;
            z-index: 10; overflow-y: auto; border-left: 5px solid #db4e4e; line-height: 1.5; box-shadow: 0 10px 40px rgba(0,0,0,0.25);
        }

        .box-wrapper.open .box-lid { transform: translateY(-120px) rotateX(75deg) scale(0.8); opacity: 0; pointer-events: none; }
        .box-wrapper.open .box-message { opacity: 1; transform: translateY(-110px) scale(1.1); }

        .reshuffle-container { margin: 10px 0; z-index: 10; }
        
        #reshuffle-btn {
            background: linear-gradient(135deg, #db4e4e 0%, #ff6b85 50%, #ff8da1 100%);
            color: white; padding: 12px 30px; border-radius: 50px; font-family: 'Steph', sans-serif;
            font-size: 1rem; cursor: pointer; border: 2px solid rgba(255,255,255,0.3); box-shadow: 0 4px 15px rgba(219, 78, 78, 0.3);
        }

        .counter-text {
            margin-top: 10px; font-size: 1rem; color: #fff; font-weight: bold;
            font-family: 'Steph', sans-serif; background: #db4e4e; padding: 10px 25px; border-radius: 50px; 
            display: inline-block; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .bottom-nav { margin-top: 15px; display: flex; justify-content: center; margin-bottom: 25px; z-index: 10; }
        
        .gift-btn {
            background: linear-gradient(135deg, #57915e 0%, #4a7a4d 50%, #3d6341 100%);
            color: white; padding: 18px 50px; font-size: 1.4rem; border-radius: 50px; font-weight: bold;
            cursor: pointer; transition: all 0.3s ease; border: 2px solid rgba(255,255,255,0.3);
        }
        .gift-btn:hover { transform: scale(1.05); }

        /* Animation Keyframes */
        @keyframes boxFadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-50px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .final-message {
            font-family: 'Steph', sans-serif; font-size: 1.8rem; color: #db4e4e; 
            background: white; padding: 40px; border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        @media (max-width: 950px) { .boxes-container { flex-direction: column; gap: 110px; height: auto; } body { height: auto; } }
    </style>
</head>
<body>
    <div class="intro-section">
        <div class="intro-text">Some of our best moments are inside these boxes, Open them to see whats inside â™¡</div>
    </div>
    
    <div class="boxes-container" id="boxes-grid"></div>
    
    <div class="reshuffle-container">
        <button id="reshuffle-btn" onclick="handleReshuffle()">Reshuffle Boxes â†»</button>
        <div class="counter-text" id="counter">Reshuffles left: ...</div>
    </div>

    <div class="bottom-nav">
        <button class="gift-btn" onclick="window.location.href='coupons.html'">I have a small gift for you ðŸ˜‰</button>
    </div>

    <script>
        const allMemories = [
            "The moment you admitted youâ€™re singleâ€¦ but not really, because you were already emotionally my girlfriend, and also waiting for me to finish this project but you didn't know that at the time ðŸ˜‚",
            "Abang = brother Kakak = sister Adik = younger than abang and kakak,\n Fitryna = my sayang ðŸ’œ \nNot sure if you remember this moment or not LOL",
            "You, and your healthy obsession with my biceps.",
            "You opened up about how your family views foreign relationships, and how they would want you to marry someone local. It made me realize just how hard this would be for both of us.",
            "When you said that bangladeshi men are dangerous and may have a wife back in bangladesh, as if i would have another wife but you ðŸ˜‚ðŸ˜‚ðŸ˜‚",
            "Hearing you say that you were waiting (multiple times actually) for me, Basically giving me the green signal to ask you out, i could not ofc but I wonder what thoughts were going on in your head at the time like why isnt this guy asking me out yet???",
            "When you told me about your struggles with English, you didn't like speaking it, but you wished you could so that you could talk to me every second. That- Was a very sweet message; I wanted to ask you to be mine at that exact second, it took a lot of restraint. I am sorry for making you wait.",
            "You opened up about your fear of not being good enough, not pretty enough, not slim enough and I reassured you that I was already here, already choosing you, only because its you.",
            "You asking for post workout pictures of me, because you want to see me all sweaty and naked (You pervert! I love it tho)"
        ];

        // State variables
        let shuffledList = [];
        let currentIndex = 0;
        let reshufflesLeft = 0;

        // True Shuffle Algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function initGame() {
            // 1. Shuffle list ONCE at start
            shuffledList = shuffleArray([...allMemories]);
            
            // 2. Determine how many reshuffles we actually need
            // We show 3 initially, so subtract 1 set from total sets
            reshufflesLeft = Math.ceil(allMemories.length / 3) - 1;
            document.getElementById('counter').innerText = `Reshuffles left: ${reshufflesLeft}`;

            // 3. Render first 3
            renderBoxes();
        }

        function renderBoxes() {
            const grid = document.getElementById('boxes-grid');
            grid.innerHTML = '';
            
            // Slice the next 3 items from the master list
            const currentSet = shuffledList.slice(currentIndex, currentIndex + 3);
            
            // Advance the index for next time
            currentIndex += 3;

            currentSet.forEach(memory => {
                const wrapper = document.createElement('div');
                wrapper.className = 'box-wrapper';
                wrapper.onclick = () => wrapper.classList.toggle('open');
                
                wrapper.innerHTML = `
                    <div class="box-lid"></div>
                    <div class="box-message">${memory}</div>
                    <div class="box-body">
                        <span style="font-size: 3rem; color: white;">?</span>
                    </div>
                `;
                grid.appendChild(wrapper);
            });
        }

        function handleReshuffle() {
            const grid = document.getElementById('boxes-grid');

            // If we have shown all unique memories, show the final message
            if (currentIndex >= shuffledList.length) {
                document.getElementById('reshuffle-btn').disabled = true;
                document.getElementById('counter').innerText = "Reshuffles left: 0";
                
                // Animation for leaving boxes
                grid.style.animation = "boxFadeOut 1s forwards";
                setTimeout(() => {
                    grid.innerHTML = '<div class="final-message">That is all the moments I could think of for now. Do not worry, we will be making more.</div>';
                    // Animation for message appearing
                    grid.style.animation = "fadeIn 1s forwards";
                }, 1000);
                return;
            }

            // Otherwise, decrement counter and show next set
            reshufflesLeft--;
            document.getElementById('counter').innerText = `Reshuffles left: ${reshufflesLeft}`;
            renderBoxes();
        }

        // Start logic
        initGame();
    </script>

    <script src="script.js"></script>
</body>
</html>